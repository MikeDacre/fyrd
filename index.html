<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Fyrd by MikeDacre</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Fyrd</h1>
      <h2 class="project-tagline">Python Cluster: Submit functions and shell scripts to torque, slurm, or local machines using easy python syntax.</h2>
      <a href="https://github.com/MikeDacre/fyrd" class="btn">View on GitHub</a>
      <a href="https://github.com/MikeDacre/fyrd/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/MikeDacre/fyrd/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <p><img src="http://i.imgur.com/NNbprZH.png" alt="The fyrd cluster logo — a Saxon shield reminiscent of those used in Fyrds"></p>

<h3>
<a id="what-is-fyrd" class="anchor" href="#what-is-fyrd" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>What is <em>Fyrd</em>?</h3>

<p><em>Fyrd</em> is a library for Python 2.7+ that allows easy multiprocessing-style parallelization using a batch system backend. Right now it supports <a href="http://www.adaptivecomputing.com/products/open-source/torque/">torque</a> and <a href="https://slurm.schedmd.com/">slurm</a>, but because it is written in a modular way, any batch system can be added. To request your batch system be added, please email <a href="mailto:requests@fyrd.science">requests@fyrd.science</a> or <a href="https://github.com/MikeDacre/fyrd/issues">submit and issue on the github page</a>.</p>

<p>To allow code porting, <em>fyrd</em> also has a fallback local mode, that is a wrapper around Python's own multiprocessing module that allows fyrd syntax to submit multiprocessing jobs.</p>

<h3>
<a id="a-quick-example" class="anchor" href="#a-quick-example" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>A Quick Example</h3>

<p>Say you have some piece of code that you got from somewhere, lets call it <code>really_slow_algorithm</code>, and you want to run it on 200 files and then work on then examine the results of <code>STDOUT</code>, but you need to parse the results first to get just the first two columns. Here is how you would do that:</p>

<div class="highlight highlight-source-python"><pre><span class="pl-k">import</span> os
<span class="pl-k">import</span> math
<span class="pl-k">import</span> fyrd

<span class="pl-c1">SCRIPT</span> <span class="pl-k">=</span> <span class="pl-sr"><span class="pl-k">r</span><span class="pl-pds">"""</span>really_slow_algorithm {} <span class="pl-k">|</span> awk '{print <span class="pl-c1">$</span>1, "<span class="pl-cce">\t</span>", <span class="pl-c1">$</span>2}'<span class="pl-pds">"""</span></span>

<span class="pl-k">def</span> <span class="pl-en">filter_results</span>(<span class="pl-smi">x</span>):
    <span class="pl-s"><span class="pl-pds">"""</span>If first column contains 'tomato', return the log of the second column.<span class="pl-pds">"""</span></span>
    output <span class="pl-k">=</span> []
    <span class="pl-k">for</span> i <span class="pl-k">in</span> x.split(<span class="pl-s"><span class="pl-pds">'</span><span class="pl-cce">\n</span><span class="pl-pds">'</span></span>):
    name, data <span class="pl-k">=</span> i.split(<span class="pl-s"><span class="pl-pds">'</span><span class="pl-cce">\t</span><span class="pl-pds">'</span></span>)
    <span class="pl-k">if</span> <span class="pl-s"><span class="pl-pds">'</span>tomato<span class="pl-pds">'</span></span> <span class="pl-k">in</span> name:
        output.append(math.log10(<span class="pl-c1">int</span>(data)))
    <span class="pl-k">return</span> output

script_jobs <span class="pl-k">=</span> []
<span class="pl-k">for</span> i <span class="pl-k">in</span> os.listdir(<span class="pl-s"><span class="pl-pds">'</span>input_files<span class="pl-pds">'</span></span>):
    script_jobs.append(fyrd.Job(<span class="pl-c1">SCRIPT</span>.format(i), <span class="pl-v">cores</span><span class="pl-k">=</span><span class="pl-c1">1</span>, <span class="pl-v">mem</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">'</span>10GB<span class="pl-pds">'</span></span>, <span class="pl-v">time</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">'</span>48:00:00<span class="pl-pds">'</span></span>).submit())

<span class="pl-c"># Wait for jobs to complete</span>
fyrd.wait(script_jobs)

func_jobs <span class="pl-k">=</span> []
<span class="pl-k">for</span> result <span class="pl-k">in</span> script_job:
    func_jobs.append(fyrd.Job(filter_results, (result.stdout,), <span class="pl-v">cores</span><span class="pl-k">=</span><span class="pl-c1">1</span>, <span class="pl-v">mem</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">'</span>500MB<span class="pl-pds">'</span></span>, <span class="pl-v">time</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">'</span>00:20:00<span class="pl-pds">'</span></span>).submit())

filtered <span class="pl-k">=</span> []
<span class="pl-k">for</span> i <span class="pl-k">in</span> func_jobs:
    <span class="pl-c"># Wait for job to complete and then get the function output</span>
    filtered.append(job.get())</pre></div>

<h3>
<a id="dependency-tracking" class="anchor" href="#dependency-tracking" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Dependency tracking</h3>

<p>Fyrd implements a simple dependency tracking system. Most batch systems allow dependency tracking, but they require somewhat complex syntax and a prior knowledge of the job ID, something that you do not have when you are building a pipeline. <em>Fyrd</em> therefore allows tracking of dependencies using <a href="https://fyrd.readthedocs.io/en/latest/api.html#fyrd.Job">Job objects</a>, as well as by job IDs, it you happen to have those:</p>

<div class="highlight highlight-source-python"><pre>job <span class="pl-k">=</span> fyrd.Job(<span class="pl-s"><span class="pl-pds">'</span>really_slow_algorithm big_file<span class="pl-pds">'</span></span>).submit()

job.wait()

<span class="pl-k">if</span> job.completed:
    job2 <span class="pl-k">=</span> fyrd.Job(completed_function)
<span class="pl-k">elif</span> job.failed:
    job2 <span class="pl-k">=</span> fyrd.Job(failed_function)

job3 <span class="pl-k">=</span> fyrd.Job(wrapup_function, <span class="pl-v">depends</span><span class="pl-k">=</span>job2)

<span class="pl-k">for</span> job <span class="pl-k">in</span> [job2, job3]:
    job.submit()

result <span class="pl-k">=</span> job3.get()</pre></div>

<h3>
<a id="keyword-arguments-and-profiles" class="anchor" href="#keyword-arguments-and-profiles" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Keyword Arguments and Profiles</h3>

<p>Batch systems have many possible submission options, to allow these options to work the same irrespective of cluster syntax, they are all implemented as keyword arguments to the <code>fyrd.job.Job</code> class. A complete list is available in the <a href="https://fyrd.readthedocs.io/en/latest/keywords.html">documentation</a>.</p>

<p>Because there can be many possible arguments to the batch system, and because most jobs use the same few arguments, <em>Fyrd</em> also has a <a href="https://fyrd.readthedocs.io/en/latest/basic_usage.html#profiles">profile system</a>, which allows common arguments to be bundled together. This system implements a <code>DEFAULT</code> profile, which allows job submission with no arguments at all:</p>

<div class="highlight highlight-source-python"><pre>fyrd.Job(my_function).submit().get()
fyrd.Job(long_function, <span class="pl-v">profile</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">'</span>long<span class="pl-pds">'</span></span>).submit().get()</pre></div>

<h3>
<a id="installation" class="anchor" href="#installation" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Installation</h3>

<div class="highlight highlight-source-shell"><pre>
   pip install https://github.com/MikeDacre/fyrd/archive/v0.6.1-beta.6.tar.gz --user
   fyrd conf init</pre></div>

<p>To get the latest version:</p>

<div class="highlight highlight-source-shell"><pre>
   pip install https://github.com/MikeDacre/fyrd/tarball/master --user
   fyrd conf init</pre></div>

<p>The <code>fyrd conf init</code> command initializes your environment interactively by asking questions about the local cluster system.</p>

<h3>
<a id="documentation" class="anchor" href="#documentation" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Documentation</h3>

<p>Fyrd has very comprehensive documentation on <a href="https://fyrd.readthedocs.org">Read the Docs</a>, you should definitely read it. A good place to start is the <a href="https://fyrd.readthedocs.io/en/latest/basic_usage.html#">getting started documentation</a>.</p>

<h3>
<a id="issues-and-contributing" class="anchor" href="#issues-and-contributing" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Issues and Contributing</h3>

<p>If you have any trouble with this software add an issue on <a href="https://github.com/MikeDacre/fyrd/issues">the issues page</a></p>

<p>I am always looking for help testing the software and implementing new keyword arguments. I would also very must like to add new batch system environments, but I need access to those clusters in order to test the new keyword arguments and implement queue parsing. If you would like to help with that or give me access to your cluster (for development of this package only), please email me a <a href="mailto:mike@fyrd.science">mike@fyrd.science</a>.</p>

<h3>
<a id="why-the-name" class="anchor" href="#why-the-name" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Why the Name?</h3>

<p>I gave this project the name 'Fyrd' in honor of my grandmother, Hélène Sandolphen, who was a scholar of old English. It is the old Anglo-Saxon word for 'army', particularly an army of freemen, and this code gives you an army of workers on any machine or cluster so it seemed appropriate. The logo is an Anglo Saxon shield of the kind used by the Fyrds, with a graphic of a cluster superimposed on the top.</p>

<p>The project used to be called "Python Cluster", which is more descriptive but frankly boring. Also, about half a dozen other projects have almost the same name, so it made no sense to keep that name and put the project onto PyPI.</p>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/MikeDacre/fyrd">Fyrd</a> is maintained by <a href="https://github.com/MikeDacre">MikeDacre</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>
